---
title: "Plotting maps"
output: 
    html_document:
        toc: TRUE
        toc_float: TRUE
---

Recommended packages:

* [tmap](https://github.com/mtennekes/tmap#tmap-thematic-maps-in-r): special-purpose package for *t*hematic *map*s in R. [**focus**]
* [mapview](https://r-spatial.github.io/mapview/): quick, single-function to interactively view spatial data(frames).
* [ggplot](https://ggplot2.tidyverse.org/): most popular package for datavis in R, recent and growing support for maps.
* [leaflet](https://rstudio.github.io/leaflet/): flexible, general purpose package for interactive maps.

Learn more:

* [Stackoverflow](https://stackoverflow.com).
* Documentation tmap (F1).
* Books: "[An Introduction to R for Spatial Analysis and Mapping](https://books.google.be/books?id=iwJ6DwAAQBAJ) (2018)", "[Geocomputation with R](https://geocompr.robinlovelace.net/]) (full-text)", "[Data Visualization. A practical introduction](https://socviz.co/)", "[Fundamentals of Data Visualization](https://serialmentor.com/dataviz/geospatial-data.html) (full-text).
* [Datacamp courses](https://www.datacamp.com/).


```{r, message=FALSE, warning=FALSE}
library(BelgiumMaps.StatBel)
library(mapview)
library(sf)
library(tmap)
library(readr)
library(dplyr)
library(ggplot2)
```


# Thematic maps with tmap

In an nutshell:

* **Q**uick **t**hematic **m**ap: `qtm()`
* Build map in layers with lots of control and options: `tm_shape()`, `tm_fill()`, `tm_borders()`, `tm_lines()`, etc.
* Cherry-on-top: switch between interactive and static plotting with `tmap_mode('view')` and `tmap_mode('plot')`.

Some resources:

* [Getting started with tmap](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html)
* https://geocompr.robinlovelace.net/adv-map.html
* Background and walkthrough: [Tennekes, M., 2018, tmap: Thematic Maps in R, Journal of Statistical Software, 84(6), 1-39](https://www.jstatsoft.org/article/view/v084i06).

Already showed some examples, here extra focus on:

* "Layered" building of maps.
* Binning and color scales
* Multiple (styled) borders
* Multiple maps

Tip: for _final_ tweaks, save map as SVG and edit in [Inkscape](https://inkscape.org/).




```{r, message=FALSE, warning=FALSE}
tm_shape(districts_pop) +
  tm_borders()
```

```{r, message=FALSE, warning=FALSE}
tm_shape(districts_pop) +
  tm_fill('pct_secondary')
```






```{r, message=FALSE, warning=FALSE}
tm_shape(districts_pop) +
  tm_borders(col = 'white') +
  tm_fill('pct_secondary', title = 'Emploment secondary sector')
```



```{r, message=FALSE, warning=FALSE}
tm_shape(districts_pop) +
  tm_borders(col = 'white') +
  tm_fill('pct_secondary', title = 'Emploment secondary sector') +
  tm_shape(raillines) +
  tm_lines(col = 'grey60')
```


```{r, warning=FALSE, error=FALSE}
tm_shape(nwestern) +
  tm_fill(col = 'pct_secondary') +
  tm_text('district_name', size = .5)
```


```{r, message=FALSE, warning=FALSE}
library(scales)
map_final <- tm_shape(districts_pop) +
  tm_borders(col = 'white') +
  tm_fill('pct_secondary', title = 'Secondary sector\nemployment', legend.format = percent_format(accuracy = 1), legend.hist = TRUE) +
  tm_shape(raillines) +
  tm_lines(col = 'grey60') +
  tm_layout(main.title = 'Railways & secondary sector employment in 1851', legend.outside = TRUE, frame = FALSE) +
  tm_credits('Source: Cambridge Group for the\nHistory of Population and Social Structure', position = 'right', align = 'right')
map_final
```

```{r, error=FALSE, warning=FALSE}
tmap_save(map_final, here('output/england_1851_map_final.png'), width = 1920, height = 1920)
```

